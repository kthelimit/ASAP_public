<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <style>
            table {
                text-align: center;
            }
        </style>
        <!-- 발주 품목 선택-->
        <div class="row mt-20">
            <div class="col-lg-6">
                <div class="card-style mb-30">
                    <h3 class="mb-10">발주 품목 선택</h3>
                    <p class="text-sm mb-20">
                        현재 진행되고 있는 조달계획과 관련된 품목들입니다.
                    </p>
                    <div class="table-wrapper table-responsive">
                        <div class="row">
                            <form method="get" th:action="@{/order/list}">
                                <div class="input-style-1 col-lg-5" style="display: flex; align-items: center;">
                                    <input id="searchKeyword" name="keyword"
                                           placeholder="업체명 또는 부품명 입력"
                                           th:value="${keyword}"
                                           type="text"/>
                                    <button class="main-btn primary-btn btn-hover ml-10"
                                            type="submit">
                                        검색
                                    </button>
                                </div>
                            </form>
                        </div>
                        <table class="table">
                            <thead>
                            <tr>
                                <th><h6>조달계획번호</h6></th>
                                <th><h6>업체명</h6></th>
                                <th><h6>품목명</h6></th>
                                <th><h6>조달 납기일</h6></th>
                                <th><h6>조달수량</h6></th>
                                <th><h6>선택</h6></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="procure : ${procure}">
                                <td class="min-width">
                                    <p th:text="${procure.procurePlanCode}"></p>
                                </td>
                                <td class="min-width">
                                    <p th:text="${procure.supplierName}"></p>
                                </td>
                                <td class="min-width">
                                    <p th:text="${procure.materialName}"></p>
                                </td>
                                <td class="min-width">
                                    <p th:text="${procure.procurementDueDate}"></p>
                                </td>
                                <td class="min-width">
                                    <p th:text="${procure.procurementQuantity}"></p>
                                </td>
                                <td>
                                    <a class="main-btn primary-btn btn-hover" style="padding: 12px"
                                       th:href="@{/order/list(
                                            id=${procure.planId},
                                            page=${currentPage},
                                            size=${pageSize},
                                            keyword=${keyword})}">
                                        선택</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="pagination-wrapper">
                            <ul class="pagination">
                                <li th:if="${currentPage > 1}">
                                    <a aria-label="Previous"
                                       th:href="@{/order/list(page=${currentPage - 1}, size=${pageSize},type='procurement',keyword=${keyword})}">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <li th:each="i : ${#numbers.sequence(1, totalPages)}">
                                    <a th:classappend="${i == currentPage ? 'active' : ''}"
                                       th:href="@{/order/list(page=${i}, size=${pageSize}, type='procurement',keyword=${keyword})}"
                                       th:text="${i}"></a>
                                </li>
                                <li th:if="${currentPage < totalPages}">
                                    <a aria-label="Next"
                                       th:href="@{/order/list(page=${currentPage + 1}, size=${pageSize},type='procurement', keyword=${keyword})}">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>


            <!-- 발주서 작성-->
            <div class="col-lg-6">
                <div class="card-style mb-30">
                    <h3 class="mb-10">발주서 작성</h3>
                    <p class="text-sm mb-20">
                        발주서 작성 후 버튼을 누르시면 발주서가 등록됩니다.
                    </p>
                    <div class="table-wrapper table-responsive">
                        <form th:action="@{/order/register}" method="post">
                            <table class="table">
                                <tr>
                                    <th colspan="4" style="text-align: center; background-color: lightgrey; padding-top: 5px; padding-bottom: 5px">
                                        공급자 정보
                                    </th>
                                </tr>
                                <tr th:if="${selectedOrder != null}">
                                    <th style="width:15%">업체명</th>
                                    <td style="width:35%">
                                        <p th:text="${selectedOrder.supplierName}"></p>
                                        <input type="hidden" name="supplierName" th:value="${selectedOrder.supplierName}">
                                    </td>
                                    <th style="width:15%">사업자 번호</th>
                                    <td style="width:35%">
                                        <p th:text="${businessRegistrationNumber}"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>주소</th>
                                    <td colspan="3">
                                        <p th:text="${supplierAddress}"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>발주일</th>
                                    <td>
                                        <p th:text="${orderDate}"></p>
                                        <input type="hidden" name="orderDate" th:value="${orderDate}">
                                    </td>
                                    <th>담당자</th>
                                    <td>
                                        <p th:text="${userName}"></p>
                                    </td>
                                </tr>
                            </table>
                            <table class="table">
                                <tr>
                                    <th colspan="6" style="text-align: center; background-color: lightgrey; padding-top: 5px; padding-bottom: 5px">
                                        품목 정보
                                    </th>
                                </tr>
                                <tr th:if="${selectedOrder != null}">
                                    <th style="width: 20%">조달계획 번호</th>
                                    <th style="width: 15%">품목명</th>
                                    <th style="width: 15%">단가</th>
                                    <th style="width: 15%">수량</th>
                                    <th style="width: 15%">공급가</th>
                                    <th style="width: 15%">입고 예정일</th>
                                </tr>
                                <tr th:if="${selectedOrder != null}">
                                    <td>
                                        <p th:text="${selectedOrder.procurePlanCode}"></p>
                                        <input type="hidden" name="procurePlanCode" th:value="${selectedOrder.procurePlanCode}">
                                    </td>
                                    <td>
                                        <p th:text="${selectedOrder.materialName}"></p>
                                        <input type="hidden" name="materialName" th:value="${selectedOrder.materialName}">
                                    </td>
                                    <td>
                                        [[${unitPrice}]]
                                        <input type="hidden" id="unitPrice" name="unitPrice" th:value="${unitPrice}">
                                    </td>
                                    <td style="padding-left: 5px">
                                        <input style="width: 50%" id="procurementQuantity" type="number" name="orderQuantity"
                                               th:value="${selectedOrder.procurementQuantity}" onchange="updateTotalPrice()">
                                    </td>
                                    <td id="totalPriceSet">
                                        [[${totalPrice}]]
                                        <input type="hidden" id="totalPrice" name="totalPrice" th:value="${totalPrice}">
                                    </td>
                                    <td>
                                        <p th:text="${selectedOrder.procurementDueDate}"></p>
                                        <input type="hidden" name="expectedDate" th:value="${selectedOrder.procurementDueDate}">
                                    </td>
                                </tr>
                            </table>
                            <table class="table">
                                <tr>
                                    <th>비고</th>
                                    <td><input style="width: 90%" type="text" name="remarks"></td>
                                </tr>
                                <tr>
                                    <th>합계</th>
                                    <td style="width: 15%" id="totalPriceSet2">
                                        <p th:text="'₩' + ${totalPrice}"></p>
                                    </td>
                                </tr>
                            </table>
                            <div style="text-align: right">
                                <button type="submit" class="main-btn primary-btn btn-hover">발주서 등록</button>
                            </div>
                        </form>
                    </div>
            </div>
        </div>
        <!-- 구매 발주서 관리-->
        <div class="row">
            <div class="col-lg-12">
                <div class="card-style mb-30">
                    <div class="row">
                        <div class="col-lg-6">
                            <h3 class="mb-10">구매 발주서 목록</h3>
                            <p class="text-sm mb-20">
                                발주가 완료되어 진행중인 목록입니다.
                            </p>
                            <div class="table-wrapper table-responsive">
                                <div class="row">
                                    <form method="get" th:action="@{/order/list}">
                                        <!-- Hidden field to pass the type -->
                                        <input type="hidden" name="type" th:value="orders" />

                                        <div class="input-style-1 col-lg-5" style="display: flex; align-items: center;">
                                            <input id="searchKeyword2" name="keyword"
                                                   placeholder="업체명 또는 부품명 입력"
                                                   th:value="${keyword2}"
                                                   type="text" />
                                            <button class="main-btn primary-btn btn-hover ml-10" type="submit">
                                                검색
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                    </div>
                    <div class="table-wrapper table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>
                                    <h6>조달계획번호</h6>
                                </th>
                                <th>
                                    <h6>업체명</h6>
                                </th>
                                <th>
                                    <h6>품목명</h6>
                                </th>
                                <th>
                                    <h6>발주 수량</h6>
                                </th>
                                <th>
                                    <h6>합계 금액</h6>
                                </th>
                                <th>
                                    <h6>발주일</h6>
                                </th>
                                <th>
                                    <h6>입고 예정일</h6>
                                </th>
                                <th>
                                    <h6>발주 상태</h6>
                                </th>
                            </tr>
                            <!-- end table row-->
                            </thead>
                            <tbody>
                            <tr th:each="orders : ${orders}">
                              <td th:text="${orders.procurePlanCode}"></td>
                                <td th:text="${orders.supplierName}"></td>
                                <td th:text="${orders.materialName}"></td>
                                <td th:text="${orders.orderQuantity}"></td>
                                <td th:text="${orders.totalPrice}"></td>
                                <td th:text="${orders.orderDate}"></td>
                                <td th:text="${orders.expectedDate}"></td>
                                <td th:text="${orders.status}"></td>
                            </tr>
                            <!-- end table row -->
                            </tbody>
                        </table>

                    </div>
                        <div class="pagination-wrapper">
                            <ul class="pagination">
                                <li th:if="${currentPage2 > 1}">
                                    <a th:href="@{/order/list(page2=${currentPage2 - 1}, size2=${pageSize2}, keyword2=${keyword2})}">&laquo;</a>
                                </li>
                                <li th:each="i : ${#numbers.sequence(1, totalPages2)}">
                                    <a th:classappend="${i == currentPage2 ? 'active' : ''}"
                                       th:href="@{/order/list(page2=${i}, size2=${pageSize2}, keyword2=${keyword2})}"
                                       th:text="${i}"></a>
                                </li>
                                <li th:if="${currentPage2 < totalPages2}">
                                    <a th:href="@{/order/list(page2=${currentPage2 + 1}, size2=${pageSize2}, keyword2=${keyword2})}">&raquo;</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function updateTotalPrice() {
                var procurementQuantity = $('#procurementQuantity').val();
                var unitPrice = $('#unitPrice').val();
                $('#totalPriceSet').empty();
                $('#totalPriceSet').append(procurementQuantity * unitPrice +
                    '<input type="hidden" id="totalPrice" name="totalPrice" value="' + procurementQuantity * unitPrice + '">');

                $('#totalPriceSet2').empty();
                $('#totalPriceSet2').append('<p>₩' + procurementQuantity * unitPrice + '</p>');


            }
        </script>
    </th:block>
</th:block>