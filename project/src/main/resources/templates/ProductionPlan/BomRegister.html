<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <div class="container-fluid">
            <!-- ========== title-wrapper start ========== -->
            <div class="title-wrapper pt-30">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="title">
                            <h2>상품 등록 & BOM 등록</h2>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="breadcrumb-wrapper">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="#0">생산계획 관리</a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="#0">상품 등록 & BOM 등록</a>
                                    </li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ========== title-wrapper end ========== -->


            <div class="tables-wrapper">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-style mb-30">
                            <h6 class="mb-10">상품 등록</h6>
                            <form>
                                <div class="row">
                                    <div class="col-lg-6 input-style-1">
                                        <input id="productName" name="productName" placeholder="상품명" type="text">
                                    </div>
                                    <div class="col-lg-5 input-style-1">
                                        <input id="productCode" name="productCode" placeholder="상품코드" type="text">
                                    </div>
                                    <div class="col-lg-1">
                                        <button class="main-btn btn-hover primary-btn" id="btn-product-register"> 등록
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-style mb-30">
                            <form th:action="@{/plan/registerBom}" th:method="post">
                                <h6 class="mb-10 col-lg-3">상품 선택</h6>
                                <div class="row">
                                    <div class="select-style-1 col-lg-9">
                                        <div class="select-position">
                                            <select id="productSelect" name="productSelect"
                                                    onchange="changeProductSelect()">
                                                <option>----------</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="input-style-1 col-lg-3">
                                        <input id="productCode2" name="productCode" placeholder="상품 코드" readonly
                                               type="text"
                                               value="">
                                    </div>
                                </div>
                                <h6 class="mb-10">부품 추가</h6>
                                <div class="row">
                                    <div class="col-lg-4 select-style-1">
                                        <div class="select-position">
                                            <select id="componentType" name="componentType"
                                                    required>
                                                <optgroup label="(전기자전거)">
                                                    <option value="경적">(전기자전거) 경적</option>
                                                    <option value="계기판+스로틀 레버">(전기자전거) 계기판+스로틀 레버</option>
                                                    <option value="로터">(전기자전거) 로터</option>
                                                    <option value="림">(전기자전거) 림</option>
                                                    <option value="바텀브라켓 셋">(전기자전거) 바텀브라켓 셋</option>
                                                    <option value="배터리">(전기자전거) 배터리</option>
                                                    <option value="밸브">(전기자전거) 밸브</option>
                                                    <option value="변속기(뒤)">(전기자전거) 변속기(뒤)</option>
                                                    <option value="변속기(앞)">(전기자전거) 변속기(앞)</option>
                                                    <option value="브레이크 레버 - 우">(전기자전거) 브레이크 레버 - 우</option>
                                                    <option value="브레이크 레버 - 좌">(전기자전거) 브레이크 레버 - 좌</option>
                                                    <option value="브레이크 케이블">(전기자전거) 브레이크 케이블</option>
                                                    <option value="스탠드">(전기자전거) 스탠드</option>
                                                    <option value="스포크">(전기자전거) 스포크</option>
                                                    <option value="스프라켓">(전기자전거) 스프라켓</option>
                                                    <option value="시트 클램프">(전기자전거) 시트 클램프</option>
                                                    <option value="시트 포스트">(전기자전거) 시트 포스트</option>
                                                    <option value="안장 날개">(전기자전거) 안장 날개</option>
                                                    <option value="전조등">(전기자전거) 전조등</option>
                                                    <option value="체인 휠세트">(전기자전거) 체인 휠세트</option>
                                                    <option value="캘리퍼">(전기자전거) 캘리퍼</option>
                                                    <option value="컨트롤러">(전기자전거) 컨트롤러</option>
                                                    <option value="크랭크">(전기자전거) 크랭크</option>
                                                    <option value="타이어">(전기자전거) 타이어</option>
                                                    <option value="튜브">(전기자전거) 튜브</option>
                                                    <option value="페달">(전기자전거) 페달</option>
                                                    <option value="페달 보조 센서">(전기자전거) 페달 보조 센서</option>
                                                    <option value="포크">(전기자전거) 포크</option>
                                                    <option value="프레임">(전기자전거) 프레임</option>
                                                    <option value="핸들 그립">(전기자전거) 핸들 그립</option>
                                                    <option value="핸들바">(전기자전거) 핸들바</option>
                                                    <option value="허브">(전기자전거) 허브</option>
                                                    <option value="허브 모터">(전기자전거) 허브 모터</option>
                                                    <option value="헤드셋">(전기자전거) 헤드셋</option>
                                                </optgroup>
                                                <optgroup label="(전동킥보드)">
                                                    <option value="경적+전조등">(전동킥보드) 경적+전조등</option>
                                                    <option value="계기판+스로틀 레버">(전동킥보드) 계기판+스로틀 레버</option>
                                                    <option value="기둥 프레임">(전동킥보드) 기둥 프레임</option>
                                                    <option value="로터">(전동킥보드) 로터</option>
                                                    <option value="메인 케이블">(전동킥보드) 메인 케이블</option>
                                                    <option value="발판">(전동킥보드) 발판</option>
                                                    <option value="배터리">(전동킥보드) 배터리</option>
                                                    <option value="스탠드">(전동킥보드) 스탠드</option>
                                                    <option value="캘리퍼">(전동킥보드) 캘리퍼</option>
                                                    <option value="컨트롤러">(전동킥보드) 컨트롤러</option>
                                                    <option value="타이어">(전동킥보드) 타이어</option>
                                                    <option value="핸들바">(전동킥보드) 핸들바</option>
                                                    <option value="허브 모터">(전동킥보드) 허브 모터</option>
                                                    <option value="휠">(전동킥보드) 휠</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 input-style-1">
                                        <input name="materialName" placeholder="부품명을 입력하세요." type="text">
                                    </div>
                                    <!--                                <div class="col-lg-4 select-style-1">-->
                                    <!--                                    <div class="select-position">-->
                                    <!--                                        <select id="material" name="material">-->
                                    <!--                                            <option value="material1">등록되어있는 부품명1</option>-->
                                    <!--                                            <option value="material2">등록되어있는 부품명2</option>-->
                                    <!--                                        </select>-->
                                    <!--                                    </div>-->
                                    <!--                                </div>-->
                                    <div class="col-lg-3 input-style-1">
                                        <input name="requireQuantity" placeholder="수량" type="number">
                                    </div>
                                    <div class="col-lg-1 text-align-right">
                                        <button class="main-btn primary-btn btn-hover" type="submit">추가</button>
                                    </div>
                                </div>
                            </form>
                            <h3 class="mb-10">BOM</h3>
                            <p class="text-sm mb-20">
                                현재 선택된 제품의 BOM 리스트입니다.
                            </p>
                            <div class="table-wrapper table-responsive">
                                <table class="table" id="bom-table">
                                    <tr>
                                        <th>
                                            부품 종류
                                        </th>
                                        <th>
                                            부품명
                                        </th>
                                        <th>
                                            부품 수량
                                        </th>
                                        <th>
                                            수정/삭제
                                        </th>
                                    </tr>
                                    <!-- 행 종료-->

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <script>

            //상품 리스트 불러오기용

            const main = {
                init: function () {
                    const _this = this;
                    //상품리스트 불러오기
                    _this.loadProductList();

                    //상품 저장
                    $('#btn-product-register').on('click', function () {
                        _this.productRegister();
                    });
                },

                //상품 저장
                productRegister: function () {
                    const data = {
                        productName: $('#productName').val(),
                        productCode: $('#productCode').val()
                    }
                    console.log(data.productName);
                    console.log(data.productCode);

                    if (!data.productName || data.productName.trim() === "") {
                        alert("상품명에 공백 또는 입력하지 않은 부분이 있습니다.");
                        return false;
                    } else {
                        $.ajax({
                            type       : 'POST',
                            url        : '/api/post/product',
                            dataType   : 'TEXT',
                            contentType: 'application/json; charset=utf-8',
                            data       : JSON.stringify(data)
                        }).done(function () {
                            alert("상품이 등록되었습니다.")
                            window.location.reload();
                        }).fail(function (error) {
                            alert(JSON.stringify(error));
                        });
                    }
                },


                //상품 불러오기
                loadProductList: function () {
                    $.ajax({
                        url    : "/api/load/product",
                        type   : "GET",
                        async  : false,                  // 데이터를 먼저 가져와서 변수에 세팅해줘야함
                        success: function (data) {
                            $(data).each(function () {
                                $('#productSelect').append('<option value="' + this.productCode + '">' + this.productName + '</option>')
                            })
                        }, error(e) {
                            alert("에러가 발생하였습니다");
                        }
                    })
                }
            };
            main.init();

            //상품 선택에서 상품을 선택하면 생기는 변화.
            function changeProductSelect() {
                var productSelect = document.getElementById("productSelect");

                var selectValue = productSelect.options[productSelect.selectedIndex].value;

                $('#productCode2').val(selectValue);

                //선택한 상품에 따른 BOM들을 불러오기
                loadBom(selectValue);
            }

            //BOM 불러와서 테이블에 뿌려주기
            function loadBom(productCode) {
                $.ajax({
                    url        : "/api/load/bom/" + productCode,
                    type       : "GET",
                    dataType   : "TEXT",
                    contentType: 'application/json; charset=utf-8',
                    data       : JSON.stringify(productCode),
                    success    : function (data) {
                        console.log(data);
                        console.log(data[0]);
                        console.log(data[1]);
                        console.log(data[2]);
                        console.log(data[3]);
                        console.log(data[4]);
                        str = '';

                        // $.each(data, function (i) {
                        //     console.log(data[i]);
                        //     // str += '<tr><td>' + data[i].componentType + '</td><td>' + data[i].materialName
                        //     //     + '</td><td>' + data[i].requireQuantity
                        //     //     + '</td><td><a href="#0"><i class="lni lni-pencil-alt"></i></a><a class="text-danger" href="#0">'
                        //     //     + '<i class="lni lni-trash-can"></i></a></td></tr>';
                        // })
                        // $('#bom-table').append(str);

                        // $(data).each(function () {
                        //     // $('#bom-table').append('<tr><td>' + this.componentType + '</td><td>' + this.materialName
                        //     //     + '</td><td>' + this.requireQuantity
                        //     //     + '</td><td><a href="#0"><i class="lni lni-pencil-alt"></i></a><a class="text-danger" href="#0">'
                        //     //     + '<i class="lni lni-trash-can"></i></a></td></tr>')
                        // })
                    }
                })
            }


            // //부품종류를 선택하면 생기는 변화
            // function changeComponentType() {
            //
            //     var componentSelect = document.getElementById("componentType");
            //
            //     var selectValue = componentSelect.options[componentSelect.selectedIndex].value;
            //
            //     console.log(selectValue);
            //
            //     //선택한 부품에 따른 자재 불러오기
            //     loadMaterial(selectValue);
            //
            //     //부품 리스트를 지우고 다시 채워넣는다.
            //     $('#material').empty();
            //     $('#material').append('<option>----------</option>');
            // }

            // function loadMaterial(componentValue){
            //
            //     $.ajax({
            //         url    : "/api/load/material/"+componentValue,
            //         type   : "GET",
            //         dataType: "TEXT",
            //         contentType: 'application/json; charset=utf-8',
            //         data       : JSON.stringify(componentValue),
            //         success: function (data) {
            //             console.log(data);
            //             if(data.result != null){
            //                 $.each(data.result['key'], function(key, value) {
            //                     console.log(value.data);
            //
            //                 })
            //             }
            //
            //             //
            //             //     $(data).each(function () {
            //             //     console.log(data['key']);
            //             // })
            //             // $(data).each(function () {
            //             //     dataMap2.set(this.key, this.value);
            //             //     $('#material').append('<option value="'+this.key+'">'+this.value+'</option>')
            //             // })
            //             // console.log(dataMap2);
            //
            //         }, error(e) {
            //             alert(e);
            //         }
            //     })
            // }


        </script>


    </th:block>
</th:block>