<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <style>
            body {
                height: 3000px;
            }

            .col-lg-6 {
                margin: 20px auto -25px;
                width: 1625px;
                height: auto;
            }

            .mb-10 {
                font-weight: bold;
                font-size: 30px;
                margin-bottom: 30px;
                margin-left: 10px;
            }

            thead {
                background-color: #ebebeb;
            }

            thead th:first-child {
                border-top-left-radius: 10px;
            }

            thead th:last-child {
                border-top-right-radius: 10px;
            }

            th, td {
                text-align: center;
            }

            .blue_botton {
                margin: auto 15px;
                width: 80px;
                height: 50px;
                border-radius: 8px;
            }

            .choice {
                margin: 5px;
                width: 80px;
                height: 50px;
                border-radius: 8px;
            }

            .select-position {
                width: 300px;
            }

            .search {
                margin-left: 15px;
                border: 1px solid #e5e5e5;;
                border-radius: 10px;
                width: 300px;
                height: 58px;
                position: relative;
            }

            .select-style-1 {
                display: flex;
                justify-content: space-between;
            }

            .search_tab {
                display: flex;
                justify-content: space-between;
            }

            .choice-column {
                width: 220px;
            }

            .how-ea {
                width: 100px;
            }


        </style>
        <div class="row">
            <div class="col-lg-6">
                <div class="card-style mb-30">
                    <div class="search_tab">
                        <h6 class="mb-10">입고 예정</h6>
                        <div class="select-style-1">
                            <input class="select-style-1, search"
                                   type="text"
                                   placeholder="     검색어를 입력하세요"
                                   th:value="${keyword}">
                            <a href="#0" class="main-btn active-btn btn-hover">검색</a>
                        </div>
                    </div>

                    <div class="table-wrapper table-responsive">
                        <table id="table1" class="table striped-table">
                            <thead>
                            <tr>
                                <th>
                                    <h5>발주 번호</h5>
                                </th>
                                <th>
                                    <h5>업체명</h5>
                                </th>
                                <th>
                                    <h5>부품 종류</h5>
                                </th>
                                <th>
                                    <h5>자재 이름</h5>
                                </th>
                                <th>
                                    <h5>발주일</h5>
                                </th>
                                <th>
                                    <h5>입고 수량</h5>
                                </th>
                                <th>
                                    <h5>처리 상태</h5>
                                </th>
                                <th>
                                    <h5>선택</h5>
                                </th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr th:each="import : ${importList}"
                                th:if="${import.importStatus.name() == 'ON_HOLD'}">
                                <td hidden th:text="${import.importStatus}"></td>
                                <td th:text="${import.orderCode}"></td>
                                <td th:text="${import.supplierName}"></td>

                                <!-- 중첩 반복문 -->
                                <td th:each="material : ${materialList}"
                                    th:if="${material.materialName == import.materialName}"
                                    th:text="${material.materialType}">
                                </td>

                                <td th:text="${import.materialName}"></td>

                                <!-- 중첩 반복문 -->
                                <td th:each="order : ${orderList}"
                                    th:if="${order.orderCode == import.orderCode}"
                                    th:text="${order.orderDate}">
                                </td>

                                <td th:text="${import.orderedQuantity}"></td>
                                <td>
                                    <span th:if="${import.importStatus.name() == 'ON_HOLD'}">검수 대기</span>
                                    <span th:if="${import.importStatus.name() == 'UNDER_INSPECTION'}">검수 중</span>
                                    <span th:if="${import.importStatus.name() == 'RETURNED'}">반품</span>
                                    <span th:if="${import.importStatus.name() == 'FINISHED'}">검수 완료</span>
                                </td>
                                <td>
                                    <form method="post" th:action="@{/material/updateImportStatus}">
                                        <input type="hidden" name="importId" th:value="${import.importId}"/>
                                        <input type="hidden" name="status" value="UNDER_INSPECTION"/>
                                        <button type="submit" class="main-btn active-btn btn-hover choice">
                                            검수이행
                                        </button>
                                    </form>
                                </td>
                            </tr>

                            </tbody>
                        </table>
                        <ul id="pagination1" class="pagination"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="card-style mb-30">
                    <div class="search_tab">
                        <h6 class="mb-10">입고 검수</h6>
                        <div class="select-style-1">
                            <input class="select-style-1, search" type="text" placeholder="     검색어를 입력하세요">
                            <a href="#0" class="main-btn active-btn btn-hover blue_botton">검색</a>
                        </div>
                    </div>

                    <div class="table-wrapper table-responsive">
                        <table id="table2" class="table striped-table">
                            <thead>
                            <tr>
                                <th>
                                    <h5>발주 번호</h5>
                                </th>
                                <th>
                                    <h5>업체명</h5>
                                </th>
                                <th>
                                    <h5>부품 종류</h5>
                                </th>
                                <th>
                                    <h5>자재 이름</h5>
                                </th>
                                <th>
                                    <h5>발주일</h5>
                                </th>
                                <th>
                                    <h5>합격 수량</h5>

                                </th>
                                <th>
                                    <h5>입고 수량</h5>
                                </th>
                                <th>
                                    <h5>처리 상태</h5>
                                </th>
                                <th class="choice-column">
                                    <h5>선택</h5>
                                </th>
                            </tr>
                            </thead>
                            <tbody id="inspection-tbody">
                            <tr th:each="import : ${importList}">


                                <form method="post"
                                      th:action="@{/material/updateImportStatus}"
                                      th:if="${import.importStatus.name() == 'UNDER_INSPECTION'}">

                                    <td th:text="${import.orderCode}"></td>
                                    <td th:text="${import.supplierName}"></td>

                                    <!-- 중첩 반복문 -->
                                    <td th:each="material : ${materialList}"
                                        th:if="${material.materialName == import.materialName}"
                                        th:text="${material.materialType}">
                                    </td>

                                    <td th:text="${import.materialName}"></td>

                                    <!-- 중첩 반복문 -->
                                    <td th:each="order : ${orderList}"
                                        th:if="${order.orderCode == import.orderCode}"
                                        th:text="${order.orderDate}">
                                    </td>


                                    <td th:text="${import.quantity}"></td>
                                    <td>
                                        <!-- passedQuantity 값을 입력 -->
                                        <input class="how-ea" type="number" name="passedQuantity"
                                               th:value="${import.passedQuantity}"/>
                                    </td>
                                    <td>
                                        <span th:if="${import.importStatus.name() == 'ON_HOLD'}">검수 대기</span>
                                        <span th:if="${import.importStatus.name() == 'UNDER_INSPECTION'}">검수 중</span>
                                        <span th:if="${import.importStatus.name() == 'RETURNED'}">반품 처리</span>
                                        <span th:if="${import.importStatus.name() == 'FINISHED'}">검수 완료</span>
                                    </td>
                                    <td class="choice-column">

                                        <input type="hidden" name="importId" th:value="${import.importId}"/>

                                        <!-- 검수이행 버튼 -->
                                        <button type="submit" name="status" value="FINISHED"
                                                class="main-btn active-btn btn-hover choice">
                                            검수이행
                                        </button>

                                        <!-- 반품 버튼 -->
                                        <button type="submit" name="status" value="RETURNED"
                                                class="main-btn danger-btn btn-hover choice">
                                            반품
                                        </button>
                                    </td>
                                </form>


                                <form method="post"
                                      th:action="@{/material/updateImportStatus}"
                                      th:if="${import.importStatus.name() == 'RETURNED'}">

                                    <td th:text="${import.orderCode}"></td>
                                    <td th:text="${import.supplierName}"></td>

                                    <!-- 중첩 반복문 -->
                                    <td th:each="material : ${materialList}"
                                        th:if="${material.materialName == import.materialName}"
                                        th:text="${material.materialType}">
                                    </td>

                                    <td th:text="${import.materialName}"></td>

                                    <!-- 중첩 반복문 -->
                                    <td th:each="order : ${orderList}"
                                        th:if="${order.orderCode == import.orderCode}"
                                        th:text="${order.orderDate}">
                                    </td>


                                    <td th:text="${import.quantity}"></td>
                                    <td>
                                        <!-- passedQuantity 값을 입력 -->
                                        <input class="how-ea" type="number" name="passedQuantity"
                                               th:value="${import.passedQuantity}"/>
                                    </td>
                                    <td>
                                        <span th:if="${import.importStatus.name() == 'ON_HOLD'}">검수 대기</span>
                                        <span th:if="${import.importStatus.name() == 'UNDER_INSPECTION'}">검수 중</span>
                                        <span th:if="${import.importStatus.name() == 'RETURNED'}">반품 처리</span>
                                        <span th:if="${import.importStatus.name() == 'FINISHED'}">검수 완료</span>
                                    </td>
                                    <td class="choice-column">
                                        <!-- 공통 데이터 -->
                                        <input type="hidden" name="importId" th:value="${import.importId}"/>

                                        <!-- 검수이행 버튼 -->
                                        <button type="submit" name="status" value="FINISHED"
                                                class="main-btn active-btn btn-hover choice">
                                            검수이행
                                        </button>

                                        <!-- 반품 버튼 -->
                                        <button type="submit" name="status" value="RETURNED"
                                                class="main-btn danger-btn btn-hover choice">
                                            반품
                                        </button>
                                    </td>
                                </form>
                            </tr>
                            </tbody>
                        </table>
                        <ul id="pagination2" class="pagination"></ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-6">
                <div class="card-style mb-30">
                    <div class="search_tab">
                        <h6 class="mb-10">입고 완료</h6>
                        <div class="select-style-1">
                            <input class="select-style-1, search" type="text" placeholder="     검색어를 입력하세요">
                            <a href="#0" class="main-btn active-btn btn-hover blue_botton">검색</a>
                        </div>
                    </div>
                    <div class="table-wrapper table-responsive">
                        <table id="table3" class="table striped-table">
                            <thead>
                            <tr>
                                <th>
                                    <h5>발주 번호</h5>
                                </th>
                                <th>
                                    <h5>업체명</h5>
                                </th>
                                <th>
                                    <h5>부품 종류</h5>
                                </th>
                                <th>
                                    <h5>자재 이름</h5>
                                </th>
                                <th>
                                    <h5>입고 수량</h5>
                                </th>
                                <th>
                                    <h5>결함 수량</h5>
                                </th>
                                <th>
                                    <h5>처리 상태</h5>
                                </th>
                                <th>
                                    <h5>발주일</h5>
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="import : ${importList}" th:if="${import.importStatus.name() == 'FINISHED'}">
                                <td th:text="${import.orderCode}"></td>
                                <td th:text="${import.supplierName}"></td>

                                <!-- 중첩 반복문 -->
                                <td th:each="material : ${materialList}"
                                    th:if="${material.materialName == import.materialName}"
                                    th:text="${material.materialType}">
                                </td>

                                <td th:text="${import.materialName}"></td>
                                <td th:text="${import.passedQuantity}"></td>
                                <td th:text="${import.defectiveQuantity}"></td>
                                <td>
                                    <span th:if="${import.importStatus.name() == 'ON_HOLD'}">검수 대기</span>
                                    <span th:if="${import.importStatus.name() == 'UNDER_INSPECTION'}">검수 중</span>
                                    <span th:if="${import.importStatus.name() == 'RETURNED'}">반품 처리</span>
                                    <span th:if="${import.importStatus.name() == 'FINISHED'}">검수 완료</span>
                                </td>

                                <!-- 중첩 반복문 -->
                                <td th:each="order : ${orderList}"
                                    th:if="${order.orderCode == import.orderCode}"
                                    th:text="${order.orderDate}">
                                </td>

                            </tr>
                            </tbody>
                        </table>
                        <ul id="pagination3" class="pagination"></ul>
                    </div>
                </div>
            </div>
        </div>


        <script>
            document.addEventListener("DOMContentLoaded", () => {
                function updatePagination(tableId, paginationId, currentPage, itemsPerPage) {
                    const table = document.getElementById(tableId);
                    const paginationContainer = document.getElementById(paginationId);
                    const rows = Array.from(table.getElementsByTagName("tr")).filter((row, index) => index > 0); // 첫 번째 행(헤더) 제외
                    const totalRows = rows.length;
                    const totalPages = Math.max(1, Math.ceil(totalRows / itemsPerPage)); // 최소 1페이지는 표시

                    paginationContainer.innerHTML = ''; // 기존 페이지 버튼 초기화

                    if (totalRows === 0) {
                        // 데이터가 없는 경우 첫 페이지 표시만
                        const noDataButton = document.createElement('a');
                        noDataButton.textContent = '1';
                        noDataButton.classList.add('active'); // 활성화된 버튼 표시
                        noDataButton.style.pointerEvents = 'none'; // 비활성화
                        paginationContainer.appendChild(noDataButton);
                        return;
                    }

                    // 이전 버튼
                    if (currentPage > 1) {
                        const prevButton = document.createElement('a');
                        prevButton.textContent = '«';
                        prevButton.onclick = () => showPage(tableId, paginationId, currentPage - 1, itemsPerPage);
                        paginationContainer.appendChild(prevButton);
                    }

                    // 페이지 번호 버튼
                    for (let i = 1; i <= totalPages; i++) {
                        const pageButton = document.createElement('a');
                        pageButton.textContent = i;
                        pageButton.onclick = () => showPage(tableId, paginationId, i, itemsPerPage);

                        if (i === currentPage) {
                            pageButton.classList.add('active'); // 활성 페이지 표시
                            pageButton.style.pointerEvents = 'none'; // 현재 페이지 비활성화
                        }

                        paginationContainer.appendChild(pageButton);
                    }

                    // 다음 버튼
                    if (currentPage < totalPages) {
                        const nextButton = document.createElement('a');
                        nextButton.textContent = '»';
                        nextButton.onclick = () => showPage(tableId, paginationId, currentPage + 1, itemsPerPage);
                        paginationContainer.appendChild(nextButton);
                    }
                }

                function showPage(tableId, paginationId, pageNumber, itemsPerPage) {
                    const table = document.getElementById(tableId);
                    const rows = Array.from(table.getElementsByTagName("tr")).filter((row, index) => index > 0); // 첫 번째 행(헤더) 제외
                    const totalRows = rows.length;
                    const totalPages = Math.max(1, Math.ceil(totalRows / itemsPerPage)); // 최소 1페이지는 표시

                    // 모든 행 숨기기
                    rows.forEach(row => (row.style.display = 'none'));

                    if (totalRows > 0) {
                        const start = (pageNumber - 1) * itemsPerPage;
                        const end = Math.min(start + itemsPerPage, totalRows);

                        // 현재 페이지의 행 표시
                        for (let i = start; i < end; i++) {
                            rows[i].style.display = '';
                        }
                    }

                    // 페이지네이션 업데이트
                    updatePagination(tableId, paginationId, pageNumber, itemsPerPage);
                }

                // 각 테이블 개별적으로 처리
                showPage('table1', 'pagination1', 1, 5); // 테이블 ID, 페이지네이션 ID, 시작 페이지, 항목 수
                showPage('table2', 'pagination2', 1, 5);
                showPage('table3', 'pagination3', 1, 5);
            });

        </script>
    </th:block>
</th:block>
